"use strict";exports.id=4773,exports.ids=[4773],exports.modules={24773:(e,t,r)=>{r.d(t,{registerUser:()=>l});var a=r(65056),o=r(67096),s=r.n(o),n=r(84770),i=r(62783);async function l({name:e,email:t,password:r}){if(await a.default.user.findUnique({where:{email:t}}))throw Error("User already exists");let o=await s().hash(r,10),l=await a.default.user.create({data:{name:e,email:t,hashedPassword:o,isApproved:!1}}),c=(0,n.randomBytes)(32).toString("hex"),p=new Date(Date.now()+864e5);await a.default.verificationToken.create({data:{identifier:t,token:c,expires:p}});try{await (0,i.xs)(l)}catch(e){console.error("Failed to send admin notification",e)}try{await (0,i.zk)(t,c)}catch(e){console.error("Failed to send verification email",e)}return l}},62783:(e,t,r)=>{r.d(t,{Yb:()=>l,xs:()=>i,zk:()=>n});var a=r(97585);let o=process.env.SMTP_URL||process.env.SMTP_HOST,s=a.createTransport(o||{host:process.env.SMTP_HOST,port:Number(process.env.SMTP_PORT||587),auth:process.env.SMTP_USER?{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}:void 0});async function n(e,t){let r=process.env.NEXTAUTH_URL||"http://localhost:3000",a=`${r}/verify?token=${encodeURIComponent(t)}&email=${encodeURIComponent(e)}`;return await s.sendMail({from:process.env.EMAIL_FROM||"no-reply@example.com",to:e,subject:"Verify your email",html:`<p>Please verify your email by clicking the link below:</p><p><a href="${a}">Verify email</a></p>`})}async function i(e){let t=(process.env.ADMIN_EMAILS||"").split(",").map(e=>e.trim()).filter(Boolean);if(0===t.length)return;let r=`New user registration: ${e.email}`,a=`<p>A new user has registered:</p><p>Name: ${e.name||"-"}<br/>Email: ${e.email}</p>`;for(let e of t)try{await s.sendMail({from:process.env.EMAIL_FROM||"no-reply@example.com",to:e,subject:r,html:a})}catch(t){console.error("Failed to send admin notification to",e,t)}}async function l(e){return s.sendMail({from:process.env.EMAIL_FROM||"no-reply@example.com",to:e.to,subject:e.subject,html:e.html,text:e.text})}},65056:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s,prisma:()=>o});var a=r(53524);let o=global.prisma||new a.PrismaClient,s=o}};